<?xml version="1.0"?>
<launch>
  <!-- 
    Vision System Launch File
    This launch file starts the ZED camera node and cv_publishers with proper topic remapping
  -->

  <!-- Arguments -->
  <arg name="camera_name" default="zed2i" />
  <arg name="camera_model" default="zed2i" />
  <arg name="base_frame" default="base_link" />
  <arg name="publish_tf" default="true" />
  <arg name="publish_map_tf" default="true" />
  <arg name="camera_fps" default="15" />
  <arg name="depth_mode" default="ULTRA" />
  <arg name="resolution" default="HD720" />
  <arg name="enable_object_detection" default="false" />
  <arg name="enable_point_cloud" default="true" />
  <arg name="use_standardized_topics" default="true" />
  <arg name="rviz" default="false" />
  
  <!-- Choose whether to apply topic remapping -->
  <group if="$(arg use_standardized_topics)">
    <!-- Standard camera topics -->
    <arg name="rgb_topic" value="/camera/rgb/image_raw" />
    <arg name="depth_topic" value="/camera/depth/image_raw" />
    <arg name="camera_info_topic" value="/camera/rgb/camera_info" />
    <arg name="pose_topic" value="/camera/pose" />
    <arg name="point_cloud_topic" value="/camera/point_cloud" />
    
    <!-- Apply remappings for ZED camera -->
    <remap from="/$(arg camera_name)/zed_node/rgb/image_rect_color" to="$(arg rgb_topic)" />
    <remap from="/$(arg camera_name)/zed_node/depth/depth_registered" to="$(arg depth_topic)" />
    <remap from="/$(arg camera_name)/zed_node/rgb/camera_info" to="$(arg camera_info_topic)" />
    <remap from="/$(arg camera_name)/zed_node/pose" to="$(arg pose_topic)" />
    <remap from="/$(arg camera_name)/zed_node/point_cloud/cloud_registered" to="$(arg point_cloud_topic)" />
  </group>
  
  <!-- Launch ZED Wrapper -->
  <include file="$(find zed_wrapper)/launch/zed2i.launch">
    <arg name="camera_name" value="$(arg camera_name)" />
    <arg name="base_frame" value="$(arg base_frame)" />
    <arg name="publish_tf" value="$(arg publish_tf)" />
    <arg name="publish_map_tf" value="$(arg publish_map_tf)" />
    <arg name="camera_fps" value="$(arg camera_fps)" />
    <arg name="depth_mode" value="$(arg depth_mode)" />
    <arg name="resolution" value="$(arg resolution)" />
  </include>

  <!-- Launch cv_publishers -->
  <include file="$(find autonomy)/launch/cv_publishers.launch">
    <arg name="camera_name" value="$(arg camera_name)" />
    <arg name="use_standardized_topics" value="$(arg use_standardized_topics)" />
    <arg name="rviz" value="$(arg rviz)" />
  </include>
  
  <!-- Launch RViz for visualization (optional) -->
  <group if="$(arg rviz)">
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find autonomy)/config/vision_system.rviz" />
  </group>

</launch>